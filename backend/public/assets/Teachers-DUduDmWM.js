import{u as K,r as l,y as m,j as a,L as Q,a as u}from"./index-C9oXW-tM.js";import{u as V,E as W,D as X,C as Z,M as g,L as d,T as i,b as P,B as S}from"./usePermission-C2zUwgS5.js";import{S as ee,B as D,T as ae}from"./Table-DdFPMSYR.js";import"./index-DRR3yZ9n.js";function de(){const E=K(),{permissions:c,loading_1:F}=V("/users/teachers"),[R,b]=l.useState([]),[v,x]=l.useState(""),[_,p]=l.useState(""),[k,y]=l.useState(""),[j,f]=l.useState(""),[h,n]=l.useState([]),[$,B]=l.useState([]),[M,N]=l.useState(!1),[L,w]=l.useState(!1),[C,q]=l.useState(null),[z,A]=l.useState(!1);l.useEffect(()=>{F||(c.read?(async()=>{try{A(!0);const s=await u.get("/teachers");b(s.data||[]);const t=await u.get("/class-types");B(t.data||[]),A(!1)}catch(s){T(s)}})():(E("/"),m.error("You don't have permission to view this page",{theme:"dark"})))},[c,E,F]);const T=e=>{var s;console.error("API Error:",e),((s=e.response)==null?void 0:s.status)===401?(localStorage.removeItem("token"),m.error("Session expired. Please login again.",{theme:"dark"}),E("/")):m.error("An error occurred. Please try again.",{theme:"dark"})},O=async()=>{var e;if(!v||!_||!k||!j||!h.length){m.error("All fields are required.",{theme:"dark"});return}try{const s=await u.post("/teachers",{first_name:v,last_name:_,email:k,password:j,rates:h});b([...(e=s.data)==null?void 0:e.teachers]),x(""),p(""),y(""),f(""),n([]),m.success("Teacher added successfully!",{theme:"dark"}),N(!1)}catch(s){T(s)}},H=async e=>{var s;try{const t=await u.delete(`/teachers/${e}`);b([...(s=t.data)==null?void 0:s.teachers]),m.success("Teacher deleted successfully!",{theme:"dark"})}catch(t){T(t)}},J=e=>{q(e),x(e.first_name),p(e.last_name),y(e.email),f(""),n(e.TeacherRates||[]),w(!0)},U=async()=>{if(C)try{const e={first_name:v,last_name:_,email:k};j&&(e.password=j),await u.put(`/teachers/${C.id}`,e),await u.post(`/teachers/${C.id}/rates`,{rates:h});const s=await u.get("/teachers");b([...s.data]),w(!1),q(null),x(""),p(""),y(""),f(""),n([]),m.success("Teacher updated successfully!",{theme:"dark"})}catch(e){T(e)}},I=(e,s)=>{n(t=>{const r=[...t],o=r.findIndex(G=>G.class_type_id===e);return o!==-1?r[o].rate=s:r.push({class_type_id:e,rate:s}),r})},Y=[{title:"No",dataIndex:"index",width:"8%",key:"index",render:(e,s,t)=>t+1},{title:"First Name",dataIndex:"first_name",key:"first_name",sorter:(e,s)=>e.first_name.localeCompare(s.first_name)},{title:"Last Name",dataIndex:"last_name",key:"last_name",sorter:(e,s)=>e.last_name.localeCompare(s.last_name)},{title:"Email",dataIndex:"email",key:"email",sorter:(e,s)=>e.email.localeCompare(s.email)},{title:"Class Type",dataIndex:"class_types",key:"class_types",width:"25%",render:(e,s)=>{var t;return a.jsx(a.Fragment,{children:(t=s.TeacherRates)==null?void 0:t.map(r=>{var o;return a.jsxs("span",{children:[" ",(o=r==null?void 0:r.class_type)==null?void 0:o.name," "]},r==null?void 0:r.class_type_id)})})}}].concat(c.update||c.delete?[{title:"Action",key:"action",render:(e,s)=>a.jsxs(ee,{size:"middle",children:[c.update&&a.jsx(D,{type:"text",icon:a.jsx(W,{}),onClick:()=>J(s),style:{color:"white"}}),c.delete&&a.jsx(D,{type:"text",icon:a.jsx(X,{}),onClick:()=>H(s.id),style:{color:"#ef4444"}})]})}]:[]);return F?a.jsx(Q,{}):a.jsxs(Z,{className:"max-h-[80vh] overflow-auto",children:[a.jsxs("div",{className:"overflow-x-auto shadow-md sm:rounded-lg",children:[c.create&&a.jsx("button",{className:"mb-3 inline-flex items-center rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-4 focus:ring-gray-100 dark:border-gray-600 dark:bg-gray-800 dark:text-white dark:hover:border-gray-600 dark:hover:bg-gray-700 dark:focus:ring-gray-700",type:"button",onClick:()=>{N(!0),x(""),p(""),y(""),f(""),n([])},children:"+ Add Teacher"}),a.jsx(ae,{style:{width:"70vw"},columns:Y,dataSource:R.map((e,s)=>({...e,key:s})),loading:{spinning:z,size:"large"},pagination:!1,className:"custom-table",scroll:{y:"50vh"},sticky:!0})]}),c.create&&a.jsxs(g,{show:M,size:"md",onClose:()=>N(!1),popup:!0,children:[a.jsx(g.Header,{}),a.jsx(g.Body,{children:a.jsxs("div",{className:"space-y-6",children:[a.jsx("h3",{className:"text-xl font-medium text-gray-900 dark:text-white",children:"Add Teacher"}),a.jsxs("div",{children:[a.jsx("div",{className:"mb-2 block",children:a.jsx(d,{htmlFor:"name",value:"First Name"})}),a.jsx(i,{id:"first_name",placeholder:"Jack",required:!0,value:v,onChange:e=>x(e.target.value)})]}),a.jsxs("div",{children:[a.jsx("div",{className:"mb-2 block",children:a.jsx(d,{htmlFor:"last name",value:"Last Name"})}),a.jsx(i,{id:"last_name",type:"text",placeholder:"Smith",required:!0,value:_,onChange:e=>p(e.target.value)})]}),a.jsxs("div",{children:[a.jsx("div",{className:"mb-2 block",children:a.jsx(d,{htmlFor:"email",value:"Email"})}),a.jsx(i,{id:"email",type:"email",placeholder:"jack.smith@example.com",required:!0,value:k,onChange:e=>y(e.target.value)})]}),a.jsxs("div",{children:[a.jsx("div",{className:"mb-2 block",children:a.jsx(d,{htmlFor:"password",value:"Password"})}),a.jsx(i,{id:"password",type:"password",placeholder:"********",required:!0,value:j,onChange:e=>f(e.target.value)})]}),$.map(e=>{var s;return a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(P,{id:`class_type_${e.id}`,onChange:t=>{t.target.checked?n(r=>[...r,{class_type_id:e.id,rate:""}]):n(r=>r.filter(o=>o.class_type_id!==e.id))}}),a.jsx(d,{htmlFor:`class_type_${e.id}`,children:e.name})]}),a.jsx(i,{id:`rate_per_type_${e.id}`,type:"number",placeholder:"10",value:((s=h.find(t=>t.class_type_id===e.id))==null?void 0:s.rate)||"",onChange:t=>I(e.id,t.target.value),disabled:!h.some(t=>t.class_type_id===e.id)})]},e.id)}),a.jsxs("div",{className:"flex flex-auto",children:[a.jsx(S,{className:"flex-none",onClick:O,children:"Add"}),a.jsx(S,{className:"ml-2 flex-none",onClick:()=>N(!1),children:"Cancel"})]})]})})]}),c.update&&a.jsxs(g,{show:L,size:"md",onClose:()=>w(!1),popup:!0,children:[a.jsx(g.Header,{}),a.jsx(g.Body,{children:a.jsxs("div",{className:"space-y-6",children:[a.jsx("h3",{className:"text-xl font-medium text-gray-900 dark:text-white",children:"Edit Teacher"}),a.jsxs("div",{children:[a.jsx("div",{className:"mb-2 block",children:a.jsx(d,{htmlFor:"name",value:"First Name"})}),a.jsx(i,{id:"first_name",required:!0,value:v,onChange:e=>x(e.target.value)})]}),a.jsxs("div",{children:[a.jsx("div",{className:"mb-2 block",children:a.jsx(d,{htmlFor:"last name",value:"Last Name"})}),a.jsx(i,{id:"last_name",required:!0,value:_,onChange:e=>p(e.target.value)})]}),a.jsxs("div",{children:[a.jsx("div",{className:"mb-2 block",children:a.jsx(d,{htmlFor:"email",value:"Email"})}),a.jsx(i,{id:"email",type:"email",placeholder:"example@example.com",required:!0,value:k,onChange:e=>y(e.target.value)})]}),a.jsxs("div",{children:[a.jsx("div",{className:"mb-2 block",children:a.jsx(d,{htmlFor:"password",value:L?"New Password (leave blank to keep current)":"Password"})}),a.jsx(i,{id:"password",type:"password",required:!L,value:j,onChange:e=>f(e.target.value)})]}),$.map(e=>{var s;return a.jsxs("div",{className:"flex items-center justify-between",children:[a.jsxs("div",{className:"flex items-center gap-2",children:[a.jsx(P,{id:`class_type_${e.id}`,checked:h.some(t=>t.class_type_id===e.id),onChange:t=>{t.target.checked?n(r=>[...r,{class_type_id:e.id,rate:"",id:C.id}]):n(r=>r.filter(o=>o.class_type_id!==e.id))}}),a.jsx(d,{htmlFor:`class_type_${e.id}`,children:e.name})]}),a.jsx(i,{id:`rate_per_type_${e.id}`,type:"number",placeholder:"10",value:((s=h.find(t=>t.class_type_id===e.id))==null?void 0:s.rate)||"",onChange:t=>I(e.id,t.target.value),disabled:!h.some(t=>t.class_type_id===e.id)})]},e.id)}),a.jsxs("div",{className:"flex flex-auto",children:[a.jsx(S,{className:"flex-none",onClick:U,children:"Update"}),a.jsx(S,{className:"ml-2 flex-none",onClick:()=>w(!1),children:"Cancel"})]})]})})]})]})}export{de as default};
