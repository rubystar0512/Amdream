import{u as _,r as l,y as n,a as x,j as e,L as z}from"./index-C9oXW-tM.js";import{u as D,E as O,D as P,C as q,M as c,L as k,T as v,B as y}from"./usePermission-C2zUwgS5.js";import{S as $,B as N,T as F}from"./Table-DdFPMSYR.js";import"./index-DRR3yZ9n.js";function G(){const h=_(),{permissions:t,loading_1:f}=D("/class/type"),[b,i]=l.useState([]),[o,d]=l.useState(""),[T,u]=l.useState(!1),[w,m]=l.useState(!1),[g,C]=l.useState(null),[S,j]=l.useState(!1);l.useEffect(()=>{f||(t.read?E():(h("/"),n.error("You don't have permission to view this page",{theme:"dark"})))},[t,h,f]);const E=async()=>{try{j(!0);const s=await x.get("/class-types");i(s.data||[]),j(!1)}catch(s){p(s),j(!1)}},p=s=>{var a;console.error("API Error:",s),((a=s.response)==null?void 0:a.status)===401?(localStorage.removeItem("token"),n.error("Session expired. Please login again.",{theme:"dark"}),h("/")):n.error("An error occurred. Please try again.",{theme:"dark"})},A=async()=>{if(!o){n.error("Name is required.",{theme:"dark"});return}try{const s=await x.post("/class-types",{name:o});i(a=>{var r;return[...a,(r=s==null?void 0:s.data)==null?void 0:r.classType]}),d(""),u(!1),n.success("Class type added successfully!",{theme:"dark"})}catch(s){p(s)}},B=async s=>{try{await x.delete(`/class-types/${s}`),i(a=>a.filter(r=>r.id!==s)),n.success("Class type deleted successfully!",{theme:"dark"})}catch(a){p(a)}},M=s=>{C(s),d(s.name),m(!0)},I=async()=>{if(!(!g||!o))try{const s=await x.put(`/class-types/${g.id}`,{name:o});i(a=>a.map(r=>r.id===g.id?s.data.classType:r)),m(!1),C(null),d(""),n.success("Class type updated successfully!",{theme:"dark"})}catch(s){p(s)}},L=[{title:"No",dataIndex:"index",key:"index",width:"8%",render:(s,a,r)=>r+1},{title:"Name",dataIndex:"name",key:"name",sorter:(s,a)=>s.name.localeCompare(a.name)}].concat(t.update||t.delete?[{title:"Action",key:"action",render:(s,a)=>e.jsxs($,{size:"middle",children:[t.update&&e.jsx(N,{type:"text",icon:e.jsx(O,{}),onClick:()=>M(a),style:{color:"white"}}),t.delete&&e.jsx(N,{type:"text",icon:e.jsx(P,{}),onClick:()=>B(a.id),style:{color:"#ef4444"}})]})}]:[]);return f?e.jsx(z,{}):e.jsxs(q,{className:"max-h-[80vh]",children:[e.jsxs("div",{className:"custom-table shadow-md sm:rounded-lg",children:[t.create&&e.jsx("button",{className:"mb-3 inline-flex items-center rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-4 focus:ring-gray-100 dark:border-gray-600 dark:bg-gray-800 dark:text-white dark:hover:border-gray-600 dark:hover:bg-gray-700 dark:focus:ring-gray-700",type:"button",onClick:()=>{u(!0),d("")},children:"+ Add Class Type"}),e.jsx(F,{style:{width:"70vw"},className:"custom-table",columns:L,dataSource:b.map((s,a)=>({...s,key:a})),pagination:!1,loading:{spinning:S,size:"large"},scroll:{y:"50vh"},sticky:!0})]}),t.create&&e.jsxs(c,{show:T,size:"md",onClose:()=>u(!1),popup:!0,children:[e.jsx(c.Header,{}),e.jsx(c.Body,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-medium text-gray-900 dark:text-white",children:"Add Class Type"}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(k,{htmlFor:"name",value:"Name"})}),e.jsx(v,{id:"name",placeholder:"Enter class type name",required:!0,value:o,onChange:s=>d(s.target.value)})]}),e.jsxs("div",{className:"flex flex-auto",children:[e.jsx(y,{className:"flex-none",onClick:A,children:"Add"}),e.jsx(y,{className:"ml-2 flex-none",onClick:()=>u(!1),children:"Cancel"})]})]})})]}),t.update&&e.jsxs(c,{show:w,size:"md",onClose:()=>m(!1),popup:!0,children:[e.jsx(c.Header,{}),e.jsx(c.Body,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-medium text-gray-900 dark:text-white",children:"Edit Class Type"}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(k,{htmlFor:"edit-name",value:"Name"})}),e.jsx(v,{id:"edit-name",required:!0,value:o,onChange:s=>d(s.target.value)})]}),e.jsxs("div",{className:"flex flex-auto",children:[e.jsx(y,{className:"flex-none",onClick:I,children:"Update"}),e.jsx(y,{className:"ml-2 flex-none",onClick:()=>m(!1),children:"Cancel"})]})]})})]})]})}export{G as default};
