import{u as R,r as s,y as i,a as _,j as e,L as U}from"./index-C9oXW-tM.js";import{u as Y,E as G,D as K,C as Q,M as x,L as r,T as n,a as q,B as w}from"./usePermission-C2zUwgS5.js";import{S as V,B as I,T as W}from"./Table-DdFPMSYR.js";import"./index-DRR3yZ9n.js";function te(){const S=R(),{permissions:l,loading_1:C}=Y("/users/students"),[P,f]=s.useState([]),[h,p]=s.useState(""),[v,j]=s.useState(""),[D,y]=s.useState(!1),[B,k]=s.useState(!1),[E,F]=s.useState(null),[N,o]=s.useState(""),[g,c]=s.useState(""),[m,u]=s.useState(""),[M,L]=s.useState(!1);s.useEffect(()=>{C||(l.read?T():(S("/"),i.error("You don't have permission to view this page",{theme:"dark"})))},[l,S,C]);const T=async()=>{try{L(!0);const a=await _.get("/students");f(a.data||[]),L(!1)}catch(a){b(a)}},b=a=>{var t;console.error("API Error:",a),((t=a.response)==null?void 0:t.status)===401?(localStorage.removeItem("token"),i.error("Session expired. Please login again.",{theme:"dark"}),S("/")):i.error("An error occurred. Please try again.",{theme:"dark"})},z=async()=>{if(!h||!v||!g||!m){i.error("First Name, Last Name, Email and Password are required.",{theme:"dark"});return}try{const a=await _.post("/students",{first_name:h,last_name:v,email:g,password:m,note:N});f(t=>{var d;return[...t,(d=a==null?void 0:a.data)==null?void 0:d.student]}),p(""),j(""),c(""),u(""),o(""),y(!1),i.success("Student added successfully!",{theme:"dark"})}catch(a){b(a)}},O=async a=>{try{await _.delete(`/students/${a}`),f(t=>t.filter(d=>d.id!==a)),i.success("Student deleted successfully!",{theme:"dark"})}catch(t){b(t)}},$=a=>{F(a),p(a.first_name),j(a.last_name),c(a.email),u(""),o(a.note||""),k(!0)},H=async()=>{if(E)try{const a={first_name:h,last_name:v,email:g,note:N};m&&(a.password=m);const t=await _.put(`/students/${E.id}`,a);f(d=>d.map(A=>A.id===E.id?t.data.student:A)),k(!1),F(null),c(""),u(""),o(""),i.success("Student updated successfully!",{theme:"dark"})}catch(a){b(a)}},J=[{title:"No",dataIndex:"index",key:"index",width:"8%",render:(a,t,d)=>d+1},{title:"First Name",dataIndex:"first_name",key:"first_name",sorter:(a,t)=>a.first_name.localeCompare(t.first_name)},{title:"Last Name",dataIndex:"last_name",key:"last_name",sorter:(a,t)=>a.last_name.localeCompare(t.last_name)},{title:"Email",dataIndex:"email",key:"email",sorter:(a,t)=>a.email.localeCompare(t.email)},{title:"Note",dataIndex:"note",key:"note",render:(a,t)=>e.jsx("div",{className:"text-center",children:t==null?void 0:t.note})}].concat(l.update||l.delete?[{title:"Action",key:"action",render:(a,t)=>e.jsxs(V,{size:"middle",children:[l.update&&e.jsx(I,{type:"text",icon:e.jsx(G,{}),onClick:()=>$(t),style:{color:"white"}}),l.delete&&e.jsx(I,{type:"text",icon:e.jsx(K,{}),onClick:()=>O(t.id),style:{color:"#ef4444"}})]})}]:[]);return C?e.jsx(U,{}):e.jsxs(Q,{className:"max-h-[80vh] overflow-auto",children:[e.jsxs("div",{className:"overflow-x-auto shadow-md sm:rounded-lg",children:[l.create&&e.jsx("button",{className:"mb-3 inline-flex items-center rounded-lg border border-gray-300 bg-white px-3 py-1.5 text-sm font-medium text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-4 focus:ring-gray-100 dark:border-gray-600 dark:bg-gray-800 dark:text-white dark:hover:border-gray-600 dark:hover:bg-gray-700 dark:focus:ring-gray-700",type:"button",onClick:()=>{y(!0),p(""),j(""),c(""),u(""),o("")},children:"+ Add Student"}),e.jsx(W,{className:"custom-table",style:{width:"70vw"},columns:J,dataSource:P.map((a,t)=>({...a,key:t})),loading:{spinning:M,size:"large"},pagination:!1,scroll:{y:"50vh"},sticky:!0})]}),e.jsxs(x,{show:D,size:"md",onClose:()=>{y(!1)},popup:!0,children:[e.jsx(x.Header,{}),e.jsx(x.Body,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-medium text-gray-900 dark:text-white",children:"Add Student"}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(r,{htmlFor:"first_name",value:"First Name"})}),e.jsx(n,{id:"first_name",placeholder:"Jack",required:!0,value:h,onChange:a=>p(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(r,{htmlFor:"last_name",value:"Last Name"})}),e.jsx(n,{id:"last_name",type:"text",placeholder:"Smith",required:!0,value:v,onChange:a=>j(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(r,{htmlFor:"email",value:"Email"})}),e.jsx(n,{id:"email",type:"email",placeholder:"student@example.com",required:!0,value:g,onChange:a=>c(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(r,{htmlFor:"password",value:"Password"})}),e.jsx(n,{id:"password",type:"password",required:!0,value:m,onChange:a=>u(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(r,{htmlFor:"note",value:"Note"})}),e.jsx(q,{id:"note",placeholder:"Add notes about the student...",rows:4,className:"dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:N,onChange:a=>o(a.target.value)})]}),e.jsxs("div",{className:"flex flex-auto",children:[e.jsx(w,{className:"flex-none",onClick:z,children:"Add"}),e.jsx(w,{className:"ml-2 flex-none",onClick:()=>y(!1),children:"Cancel"})]})]})})]}),l.update&&e.jsxs(x,{show:B,size:"md",onClose:()=>k(!1),popup:!0,children:[e.jsx(x.Header,{}),e.jsx(x.Body,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-medium text-gray-900 dark:text-white",children:"Edit Student"}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(r,{htmlFor:"edit_first_name",value:"First Name"})}),e.jsx(n,{id:"edit_first_name",required:!0,value:h,onChange:a=>p(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(r,{htmlFor:"edit_last_name",value:"Last Name"})}),e.jsx(n,{id:"edit_last_name",required:!0,value:v,onChange:a=>j(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(r,{htmlFor:"edit_email",value:"Email"})}),e.jsx(n,{id:"edit_email",type:"email",required:!0,value:g,onChange:a=>c(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(r,{htmlFor:"edit_password",value:"New Password (optional)"})}),e.jsx(n,{id:"edit_password",type:"password",value:m,onChange:a=>u(a.target.value),placeholder:"Leave blank to keep current password"})]}),e.jsxs("div",{children:[e.jsx("div",{className:"mb-2 block",children:e.jsx(r,{htmlFor:"edit_note",value:"Note"})}),e.jsx(q,{id:"edit_note",placeholder:"Add notes about the student...",rows:4,className:"dark:border-gray-600 dark:bg-gray-700 dark:text-white",value:N,onChange:a=>o(a.target.value)})]}),e.jsxs("div",{className:"flex flex-auto",children:[e.jsx(w,{className:"flex-none",onClick:H,children:"Update"}),e.jsx(w,{className:"ml-2 flex-none",onClick:()=>k(!1),children:"Cancel"})]})]})})]})]})}export{te as default};
